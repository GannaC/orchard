<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>U.S. States: Population and Territory</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-1: #f4f7fb;
        --bg-2: #eef3f9;
        --ink: #16213f;
        --muted: #5b6882;
        --panel: #ffffff;
        --accent: #1f5ebd;
        --accent-soft: #78a6ef;
        --border: #dfe7f2;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Source Sans 3", "Segoe UI", "Avenir Next", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 8% 8%, #ffffff 0%, transparent 32%),
          radial-gradient(circle at 92% 12%, #e8f0ff 0%, transparent 35%),
          linear-gradient(145deg, var(--bg-1), var(--bg-2));
      }

      .wrap {
        width: min(1200px, 96vw);
        margin: 2rem auto 3rem;
      }

      .top-banner {
        width: min(1200px, 96vw);
        margin: 1rem auto 0;
        border: 1px solid #cfe0ff;
        background: linear-gradient(95deg, #0f2f66, #1f5ebd 60%, #3d7cdd);
        color: #fff;
        border-radius: 14px;
        padding: 0.7rem 0.95rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.7rem;
        box-shadow: 0 8px 18px -14px #0f2f6680;
      }

      .banner-title {
        font-weight: 700;
        letter-spacing: 0.01em;
      }

      .banner-note {
        font-size: 0.9rem;
        opacity: 0.95;
      }

      .hero {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 1.2rem 1.4rem;
        box-shadow: 0 10px 24px -20px #15264d40;
        border-top: 6px solid #f4a531;
      }

      h1 {
        margin: 0;
        font-size: clamp(1.3rem, 1.1rem + 1.7vw, 2.25rem);
        line-height: 1.15;
        letter-spacing: 0.01em;
        color: #0f2247;
      }

      .subtitle {
        margin: 0.55rem 0 0;
        color: var(--muted);
        max-width: 75ch;
      }

      .grid {
        margin-top: 1rem;
        display: grid;
        gap: 1rem;
        grid-template-columns: 1fr;
      }

      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 1rem;
        box-shadow: 0 10px 24px -20px #15264d33;
      }

      .controls {
        display: flex;
        gap: 0.6rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .controls label {
        font-weight: 600;
        color: #233354;
      }

      .controls select {
        border: 1px solid #bcccdc;
        border-radius: 10px;
        background: #fff;
        padding: 0.45rem 0.68rem;
        font: inherit;
        color: inherit;
      }

      .bars {
        margin-top: 1rem;
        display: grid;
        gap: 0.45rem;
        max-height: 68vh;
        overflow: auto;
        padding-right: 0.35rem;
      }

      .row {
        display: grid;
        grid-template-columns: minmax(120px, 180px) 1fr max-content;
        align-items: center;
        gap: 0.6rem;
        opacity: 0;
        transform: translateY(8px);
        animation: row-in 420ms cubic-bezier(0.21, 0.95, 0.29, 1) forwards;
        animation-delay: var(--delay, 0ms);
      }

      .state {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-weight: 600;
        font-size: 0.92rem;
      }

      .state-flag {
        width: 1.4rem;
        height: 1rem;
        border-radius: 2px;
        border: 1px solid #d9e3f2;
        background: #f6f8fc;
        object-fit: contain;
        flex: 0 0 auto;
      }

      .flag-fallback {
        width: 1.4rem;
        height: 1rem;
        border-radius: 2px;
        border: 1px solid #d9e3f2;
        background: #f6f8fc;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.54rem;
        font-weight: 700;
        color: #3f4f6e;
        flex: 0 0 auto;
      }

      .track {
        height: 1.35rem;
        border-radius: 999px;
        background: #eaf0f8;
        overflow: hidden;
      }

      .fill {
        height: 100%;
        width: var(--w, 0%);
        background: linear-gradient(90deg, var(--accent), #3d7cdd 58%, var(--accent-soft));
        border-radius: inherit;
        transition: width 760ms cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
      }

      .fill::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          105deg,
          transparent 0%,
          #ffffff66 45%,
          transparent 100%
        );
        transform: translateX(-120%);
        animation: shine 1.6s ease-out both;
      }

      .value {
        min-width: 84px;
        text-align: right;
        font-variant-numeric: tabular-nums;
        font-size: 0.9rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        position: sticky;
        top: 0;
        background: #fff;
      }

      th,
      td {
        text-align: left;
        padding: 0.5rem 0.42rem;
        border-bottom: 1px solid #e4ebf3;
        font-size: 0.9rem;
      }

      th {
        color: #2a3f66;
      }

      tbody tr:nth-child(even) td {
        background: #f9fbff;
      }

      td.heat {
        border-radius: 6px;
        transition: background-color 220ms ease;
      }

      .table-wrap {
        max-height: 72vh;
        min-height: 64vh;
        overflow: auto;
      }

      .table-filters {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        gap: 0.5rem;
        margin-bottom: 0.7rem;
      }

      .table-filters input,
      .table-filters select {
        border: 1px solid #c8d4e6;
        border-radius: 10px;
        background: #fff;
        padding: 0.45rem 0.58rem;
        font: inherit;
        color: inherit;
      }

      .meta {
        margin-top: 0.8rem;
        color: var(--muted);
        font-size: 0.86rem;
      }

      .status {
        margin-top: 0.85rem;
        font-size: 0.9rem;
      }

      .status.error {
        color: #b42318;
      }

      a {
        color: #1b59b7;
      }

      @keyframes row-in {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes shine {
        to {
          transform: translateX(120%);
        }
      }

      @media (min-width: 960px) {
        .grid {
          grid-template-columns: 1.2fr 1fr;
        }
      }

      @media (max-width: 760px) {
        .top-banner {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      .site-footer {
        width: min(1200px, 96vw);
        margin: 0 auto 1.2rem;
        padding: 0.9rem 0.2rem 0.2rem;
        color: #4a5875;
        font-size: 0.88rem;
        border-top: 1px solid #d7e1f0;
        display: flex;
        justify-content: space-between;
        gap: 0.7rem;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <section class="top-banner" aria-label="Project banner">
      <div class="banner-title">U.S. States Data Dashboard</div>
      <div class="banner-note">Official Census TIGERweb data with interactive analysis and filtering</div>
    </section>

    <main class="wrap">
      <section class="hero">
        <h1>All 50 U.S. States: Population and Territory</h1>
        <p class="subtitle">
          Interactive comparison using official U.S. Census Bureau TIGERweb data (2020 Census population
          and state area fields). Choose a metric to compare states by population, land area, total area,
          or population density.
        </p>
      </section>

      <section class="grid" aria-live="polite">
        <article class="panel">
          <div class="controls">
            <label for="metric">Metric</label>
            <select id="metric">
              <option value="population">Population</option>
              <option value="landArea">Land area (sq mi)</option>
              <option value="totalArea">Total area (sq mi)</option>
              <option value="density">Population density (people/sq mi)</option>
            </select>

            <label for="sort">Sort</label>
            <select id="sort">
              <option value="desc">Highest to lowest</option>
              <option value="asc">Lowest to highest</option>
            </select>

          </div>

          <div class="bars" id="bars" role="img" aria-label="State comparison chart"></div>
          <div class="status" id="status">Loading Census data...</div>
          <p class="meta" id="sources"></p>
        </article>

        <article class="panel">
          <h2 style="margin: 0 0 0.7rem; font-size: 1.1rem">State data table</h2>
          <div class="table-filters">
            <input id="filterState" type="search" placeholder="Filter by state name..." aria-label="Filter by state name" />
            <select id="filterRegion" aria-label="Filter by region">
              <option value="all">All regions</option>
              <option value="Northeast">Northeast</option>
              <option value="Midwest">Midwest</option>
              <option value="South">South</option>
              <option value="West">West</option>
            </select>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>State</th>
                  <th>Population</th>
                  <th>Land sq mi</th>
                  <th>Total sq mi</th>
                  <th>Density</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </article>
      </section>
    </main>

    <footer class="site-footer">
      <div>Data source: U.S. Census Bureau TIGERweb (POP100, AREALAND, AREAWATER).</div>
      <div>Built for /Users/anna/Documents/New project</div>
    </footer>

    <script>
      const STATES_50_FIPS = new Set([
        "01", "02", "04", "05", "06", "08", "09", "10", "12", "13",
        "15", "16", "17", "18", "19", "20", "21", "22", "23", "24",
        "25", "26", "27", "28", "29", "30", "31", "32", "33", "34",
        "35", "36", "37", "38", "39", "40", "41", "42", "44", "45",
        "46", "47", "48", "49", "50", "51", "53", "54", "55", "56"
      ]);

      const FIPS_TO_ABBR = {
        "01": "AL", "02": "AK", "04": "AZ", "05": "AR", "06": "CA", "08": "CO", "09": "CT", "10": "DE", "12": "FL", "13": "GA",
        "15": "HI", "16": "ID", "17": "IL", "18": "IN", "19": "IA", "20": "KS", "21": "KY", "22": "LA", "23": "ME", "24": "MD",
        "25": "MA", "26": "MI", "27": "MN", "28": "MS", "29": "MO", "30": "MT", "31": "NE", "32": "NV", "33": "NH", "34": "NJ",
        "35": "NM", "36": "NY", "37": "NC", "38": "ND", "39": "OH", "40": "OK", "41": "OR", "42": "PA", "44": "RI", "45": "SC",
        "46": "SD", "47": "TN", "48": "TX", "49": "UT", "50": "VT", "51": "VA", "53": "WA", "54": "WV", "55": "WI", "56": "WY"
      };

      const STATE_TO_REGION = {
        Alabama: "South", Alaska: "West", Arizona: "West", Arkansas: "South",
        California: "West", Colorado: "West", Connecticut: "Northeast", Delaware: "South",
        Florida: "South", Georgia: "South", Hawaii: "West", Idaho: "West",
        Illinois: "Midwest", Indiana: "Midwest", Iowa: "Midwest", Kansas: "Midwest",
        Kentucky: "South", Louisiana: "South", Maine: "Northeast", Maryland: "South",
        Massachusetts: "Northeast", Michigan: "Midwest", Minnesota: "Midwest", Mississippi: "South",
        Missouri: "Midwest", Montana: "West", Nebraska: "Midwest", Nevada: "West",
        "New Hampshire": "Northeast", "New Jersey": "Northeast", "New Mexico": "West", "New York": "Northeast",
        "North Carolina": "South", "North Dakota": "Midwest", Ohio: "Midwest", Oklahoma: "South",
        Oregon: "West", Pennsylvania: "Northeast", "Rhode Island": "Northeast", "South Carolina": "South",
        "South Dakota": "Midwest", Tennessee: "South", Texas: "South", Utah: "West",
        Vermont: "Northeast", Virginia: "South", Washington: "West", "West Virginia": "South",
        Wisconsin: "Midwest", Wyoming: "West"
      };

      const STATE_FLAG_FILE = {
        Alabama: "Flag of Alabama.svg",
        Alaska: "Flag of Alaska.svg",
        Arizona: "Flag of Arizona.svg",
        Arkansas: "Flag of Arkansas.svg",
        California: "Flag of California.svg",
        Colorado: "Flag of Colorado.svg",
        Connecticut: "Flag of Connecticut.svg",
        Delaware: "Flag of Delaware.svg",
        Florida: "Flag of Florida.svg",
        Georgia: "Flag of Georgia (U.S. state).svg",
        Hawaii: "Flag of Hawaii.svg",
        Idaho: "Flag of Idaho.svg",
        Illinois: "Flag of Illinois.svg",
        Indiana: "Flag of Indiana.svg",
        Iowa: "Flag of Iowa.svg",
        Kansas: "Flag of Kansas.svg",
        Kentucky: "Flag of Kentucky.svg",
        Louisiana: "Flag of Louisiana.svg",
        Maine: "Flag of Maine.svg",
        Maryland: "Flag of Maryland.svg",
        Massachusetts: "Flag of Massachusetts.svg",
        Michigan: "Flag of Michigan.svg",
        Minnesota: "Flag of Minnesota.svg",
        Mississippi: "Flag of Mississippi.svg",
        Missouri: "Flag of Missouri.svg",
        Montana: "Flag of Montana.svg",
        Nebraska: "Flag of Nebraska.svg",
        Nevada: "Flag of Nevada.svg",
        "New Hampshire": "Flag of New Hampshire.svg",
        "New Jersey": "Flag of New Jersey.svg",
        "New Mexico": "Flag of New Mexico.svg",
        "New York": "Flag of New York.svg",
        "North Carolina": "Flag of North Carolina.svg",
        "North Dakota": "Flag of North Dakota.svg",
        Ohio: "Flag of Ohio.svg",
        Oklahoma: "Flag of Oklahoma.svg",
        Oregon: "Flag of Oregon.svg",
        Pennsylvania: "Flag of Pennsylvania.svg",
        "Rhode Island": "Flag of Rhode Island.svg",
        "South Carolina": "Flag of South Carolina.svg",
        "South Dakota": "Flag of South Dakota.svg",
        Tennessee: "Flag of Tennessee.svg",
        Texas: "Flag of Texas.svg",
        Utah: "Flag of Utah.svg",
        Vermont: "Flag of Vermont.svg",
        Virginia: "Flag of Virginia.svg",
        Washington: "Flag of Washington.svg",
        "West Virginia": "Flag of West Virginia.svg",
        Wisconsin: "Flag of Wisconsin.svg",
        Wyoming: "Flag of Wyoming.svg"
      };

      const state = {
        rows: [],
        metric: "population",
        sort: "desc",
        sourcePop: "",
        sourceArea: ""
      };

      const metricSelect = document.getElementById("metric");
      const sortSelect = document.getElementById("sort");
      const barsEl = document.getElementById("bars");
      const tableBody = document.getElementById("tableBody");
      const statusEl = document.getElementById("status");
      const sourcesEl = document.getElementById("sources");
      const filterStateEl = document.getElementById("filterState");
      const filterRegionEl = document.getElementById("filterRegion");

      metricSelect.addEventListener("change", () => {
        state.metric = metricSelect.value;
        render();
      });

      sortSelect.addEventListener("change", () => {
        state.sort = sortSelect.value;
        render();
      });

      filterStateEl.addEventListener("input", () => render());
      filterRegionEl.addEventListener("change", () => render());

      function formatNumber(num, decimals = 0) {
        return new Intl.NumberFormat("en-US", {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals
        }).format(num);
      }

      function stateFlagByName(name) {
        const file = STATE_FLAG_FILE[name];
        if (!file) return "";
        return `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(file)}`;
      }

      function getMetricValue(row) {
        if (state.metric === "landArea") return row.landArea;
        if (state.metric === "totalArea") return row.totalArea;
        if (state.metric === "density") return row.density;
        return row.population;
      }

      function metricLabel(row) {
        if (state.metric === "population") return formatNumber(row.population);
        if (state.metric === "landArea") return formatNumber(row.landArea, 1);
        if (state.metric === "totalArea") return formatNumber(row.totalArea, 1);
        return formatNumber(row.density, 1);
      }

      function heatColor(value, min, max) {
        if (!Number.isFinite(value) || !Number.isFinite(min) || !Number.isFinite(max)) return "transparent";
        if (max <= min) return "transparent";
        const t = (value - min) / (max - min);
        const alpha = 0.08 + t * 0.24;
        return `rgba(31, 94, 189, ${alpha.toFixed(3)})`;
      }

      function sortedRows() {
        const query = filterStateEl.value.trim().toLowerCase();
        const region = filterRegionEl.value;
        const copy = state.rows.filter((row) => {
          const matchesState = !query || row.name.toLowerCase().includes(query);
          const matchesRegion = region === "all" || row.region === region;
          return matchesState && matchesRegion;
        });
        copy.sort((a, b) => {
          const diff = getMetricValue(a) - getMetricValue(b);
          return state.sort === "asc" ? diff : -diff;
        });
        return copy;
      }

      function render() {
        if (!state.rows.length) return;
        const rows = sortedRows();
        if (!rows.length) {
          barsEl.innerHTML = "";
          tableBody.innerHTML = `<tr><td colspan="5">No states match current filters.</td></tr>`;
          return;
        }
        const max = Math.max(...rows.map(getMetricValue));
        const popValues = rows.map((r) => r.population);
        const landValues = rows.map((r) => r.landArea);
        const totalValues = rows.map((r) => r.totalArea);
        const densityValues = rows.map((r) => r.density);

        const popMin = Math.min(...popValues);
        const popMax = Math.max(...popValues);
        const landMin = Math.min(...landValues);
        const landMax = Math.max(...landValues);
        const totalMin = Math.min(...totalValues);
        const totalMax = Math.max(...totalValues);
        const densityMin = Math.min(...densityValues);
        const densityMax = Math.max(...densityValues);

        barsEl.innerHTML = rows
          .map((row, i) => {
            const width = max ? (getMetricValue(row) / max) * 100 : 0;
            const flagSrc = stateFlagByName(row.name);
            return `
              <div class="row" style="--delay:${Math.min(i * 22, 440)}ms">
                <div class="state"><img class="state-flag" src="${flagSrc}" alt="${row.name} flag" title="${row.name} flag" loading="lazy" referrerpolicy="no-referrer" onerror="this.outerHTML='<span class=&quot;flag-fallback&quot; aria-label=&quot;${row.name} code&quot; title=&quot;${row.name} flag&quot;>${row.abbr}</span>'" />${row.name}</div>
                <div class="track"><div class="fill" style="--w:0%" data-target="${width.toFixed(2)}%"></div></div>
                <div class="value">${metricLabel(row)}</div>
              </div>
            `;
          })
          .join("");

        requestAnimationFrame(() => {
          barsEl.querySelectorAll(".fill").forEach((el, i) => {
            const target = el.getAttribute("data-target") || "0%";
            setTimeout(() => el.style.setProperty("--w", target), Math.min(i * 14, 420));
          });
        });

        tableBody.innerHTML = rows
          .map(
            (row) => `
            <tr>
              <td>${row.name}</td>
              <td class="heat" style="background:${heatColor(row.population, popMin, popMax)}">${formatNumber(row.population)}</td>
              <td class="heat" style="background:${heatColor(row.landArea, landMin, landMax)}">${formatNumber(row.landArea, 1)}</td>
              <td class="heat" style="background:${heatColor(row.totalArea, totalMin, totalMax)}">${formatNumber(row.totalArea, 1)}</td>
              <td class="heat" style="background:${heatColor(row.density, densityMin, densityMax)}">${formatNumber(row.density, 1)}</td>
            </tr>
          `
          )
          .join("");
      }

      async function fetchFirst(urls, parser) {
        let lastErr;
        for (const url of urls) {
          try {
            const res = await fetch(url, { cache: "no-store" });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await parser(res);
            return { url, data };
          } catch (err) {
            lastErr = err;
          }
        }
        throw lastErr || new Error("All endpoints failed");
      }

      async function loadTigerStates() {
        const layerIds = [54, 62, 70];
        const urls = layerIds.map(
          (id) =>
            `https://tigerweb.geo.census.gov/arcgis/rest/services/TIGERweb/State_County/MapServer/${id}/query` +
            `?where=1%3D1&outFields=GEOID,NAME,AREALAND,AREAWATER,POP100&returnGeometry=false&f=json`
        );

        const { url, data } = await fetchFirst(urls, (res) => res.json());
        const features = Array.isArray(data.features) ? data.features : [];
        const sqMetersPerSqMile = 2589988.110336;

        return {
          url,
          rows: features
            .map((f) => f.attributes || {})
            .filter((a) => STATES_50_FIPS.has(String(a.GEOID).padStart(2, "0")))
            .map((a) => {
              const landSqMi = Number(a.AREALAND) / sqMetersPerSqMile;
              const waterSqMi = Number(a.AREAWATER) / sqMetersPerSqMile;
              const pop = Number(a.POP100);
              return {
                fips: String(a.GEOID).padStart(2, "0"),
                name: a.NAME,
                abbr: FIPS_TO_ABBR[String(a.GEOID).padStart(2, "0")] || "",
                region: STATE_TO_REGION[a.NAME] || "Other",
                population: pop,
                landArea: landSqMi,
                totalArea: landSqMi + waterSqMi,
                density: pop / landSqMi
              };
            })
        };
      }

      async function init() {
        try {
          const tiger = await loadTigerStates();
          const filtered = tiger.rows.filter(
            (row) =>
              Number.isFinite(row.population) &&
              Number.isFinite(row.landArea) &&
              row.landArea > 0
          );

          state.rows = filtered;
          state.sourcePop = tiger.url;
          state.sourceArea = tiger.url;

          statusEl.textContent = `Loaded ${filtered.length} states from U.S. Census TIGERweb.`;
          statusEl.classList.remove("error");
          sourcesEl.innerHTML = `Source: <a href="${state.sourcePop}" target="_blank" rel="noreferrer">U.S. Census TIGERweb State_County layer query</a> (2020 Census POP100 with AREALAND/AREAWATER).`;
          render();
        } catch (err) {
          statusEl.textContent = `Could not load Census data in this browser session. ${err.message}`;
          statusEl.classList.add("error");
          sourcesEl.innerHTML = "Official source intended: U.S. Census Bureau TIGERweb State_County layer.";
          console.error(err);
        }
      }

      init();
    </script>
  </body>
</html>
